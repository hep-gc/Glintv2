<head>
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
</head>


<div><h2> "{{account}}" projects </h2></div>
{% if feedback_msg is not None %}
	<div><p style="color:green">{{feedback_msg}}</p></div>
{% endif %}
{% if error_msg is not None %}
	<div><p style="color:red">{{error_msg}}</p></div>
{% endif %}
<table class="main_table">
	<tr class="main_table">
		<th class="main_table">Alias</th>
		<th class="main_table">Project</th>
		<th class="main_table">Auth URL</th>
		<th class="main_table">Username</th>
		<th class="edit_column" />
	</tr>
	{% for repo in repo_list %}
		<tr class="main_table">
			<th class="main_table">
				{{repo.alias}}
			</th>
			<td class="main_table">
				{{repo.tenant}}
			</td>
			<td class="main_table">
				{{repo.auth_url}}
			</td>
			<td class="main_table">
				{{repo.username}}
			</td>

			<td class="edit_column">
				<button type="button" class="btn btn-info" data-toggle="collapse" data-target="#{{repo.proj_id}}" style="margin-right: 5px"> Edit </button>
				<div class="collapse" id="{{repo.proj_id}}" style="width: 400px">
					<form name="{{repo.proj_id}}" action="/ui/update_repo/{{account}}/" method="post">
						{% csrf_token %}
						<table>
						    <tr><td><label for="auth_url">Auth URL</label></td>
						    <td><input type="text" name="auth_url" id="" value="{{repo.auth_url}}" /></td></tr>

						    <tr><td><label for="tenant">Tenant</label></td>
						    <td><input type="text" name="tenant" id="" value="{{repo.tenant}}" /></td></tr>

						    <tr><td><label for="username">Username</label></td>
						    <td><input type="text" name="username" id="" value="{{repo.username}}" /></td></tr>
						    <tr><td><label for="password">Password</label></td>
						    <td><input type="password" name="password" id="" value="{{repo.password}}" /></td></tr>
							<tr><td><input type="submit" value="Update Repo" /></td>
							<input type="hidden" name="proj_id" value="{{repo.proj_id}}" />
							<td><input type="button" onclick="confirmDelete('{{repo.tenant}}', '{{repo.proj_id}}')" value="Delete" style="background-color: red; color: black; float: right"/></td></tr>
						</table>
					</form>
				</div>
			</td>
		</tr>
	{% endfor %}
</table>
<br/>
<a href="/ui/add_repo/{{account}}"><input type="button" value="Add repo to {{account}}"/></a>
<br/><br/><br/>
<a href="/ui/project_details/{{account}}"><input type="button" value="Back to Matrix"/></a>


<style>
.main_table {
    border: 1px solid black;
    border-collapse: collapse;
    padding: 5px;
}
.edit_column {
	border: none;
    border-collapse: collapse;
    padding: 5px;
}
</style>

<script>
	function confirmDelete(repo, form_name) {
	    if (confirm("Are you sure you want to delete '" + repo + "'") == true) {;
	        $.post("/ui/delete_repo/{{account}}/", {repo: repo, repo_id: form_name, csrfmiddlewaretoken: '{{csrf_token}}'}, function(result){
	        	if(result){
	        		window.location.href = "/ui/manage_repos/{{account}}";
	        	}
	        	else{
	        		//something happened with delete, maybe give an error msg?
	        	}


	        })

	    } 
	}
</script>